---
import Layout from '@/layouts/Layout.astro'
import Panel from '@/components/Panel.astro'
import { getCollection, type CollectionEntry } from 'astro:content'
import { formatDate } from '@/lib/utils'

// Ambil 5 tulisan terbaru
const allWriting = await getCollection('writing')
const recentWriting: CollectionEntry<'writing'>[] = allWriting
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .slice(0, 5)

// Ambil 3 proyek terbaru
const allWork = await getCollection('work')
const recentWork: CollectionEntry<'work'>[] = allWork
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .slice(0, 3)
---

<Layout title="Command Center" class="max-w-7xl">
  <div class="grid grid-cols-1 md:grid-cols-12 gap-4 min-h-[80vh] content-center py-10">
    
    {/* HEADER MODULE (12 Columns) */}
    <Panel class="md:col-span-12 flex flex-col md:flex-row items-center justify-between gap-4 py-8">
      <div>
        <h1 class="text-4xl font-mono font-bold text-foreground tracking-tighter">
          ALVITO<span class="text-amber-500">.DEV</span>
        </h1>
        <div class="flex gap-4 mt-2 text-xs font-mono text-muted-foreground">
          <p>&gt; SYSTEM_STATUS: <span class="text-green-500 animate-pulse">ONLINE</span></p>
          <p>&gt; LAST_LOGIN: {new Date().toLocaleTimeString()}</p>
        </div>
      </div>
      <div class="text-right hidden md:block space-y-1">
        <p class="text-xs text-muted-foreground font-mono">LOCATION: YOGYAKARTA, ID</p>
        <p class="text-xs text-muted-foreground font-mono">LAT: -7.7956 // LONG: 110.3695</p>
      </div>
    </Panel>

    {/* WRITING MODULE (7 Columns) */}
    <Panel title="// RECENT_LOGS" class="md:col-span-7 h-full">
      <ul class="space-y-1">
        {recentWriting.map((post) => (
          <li class="group/item">
            <a 
              href={`/writing/${post.id}`} 
              class="flex items-baseline justify-between py-2 border-b border-border/50 hover:pl-2 transition-all cursor-pointer"
            >
              <div class="flex items-center gap-2 overflow-hidden">
                <span class="text-amber-500 opacity-0 group-hover/item:opacity-100 transition-opacity text-xs">&gt;</span>
                <span class="text-foreground/80 hover:text-amber-500 font-mono text-sm truncate transition-colors">
                  {post.data.title}
                </span>
              </div>
              <span class="text-[10px] text-muted-foreground font-mono whitespace-nowrap pl-4">
                {formatDate(post.data.publishDate)}
              </span>
            </a>
          </li>
        ))}
      </ul>
      <div class="mt-4 pt-2 border-t border-border/50 text-right">
        <a href="/writing" class="text-xs font-mono text-amber-500 hover:underline">
          [VIEW_ALL_LOGS]
        </a>
      </div>
    </Panel>

    {/* WORK MODULE (5 Columns) */}
    <Panel title="// ACTIVE_TASKS" class="md:col-span-5 h-full flex flex-col">
      <div class="space-y-3 grow">
        {recentWork.map((project) => (
          <a href={project.data.demoLink || project.data.repoLink || '#'} class="block group">
            <div class="flex items-center justify-between bg-secondary/20 p-3 border border-border group-hover:border-amber-500/50 transition-colors">
              <div class="flex flex-col gap-1">
                <span class="text-foreground text-sm font-bold truncate">{project.data.title}</span>
                <span class="text-[10px] text-muted-foreground font-mono uppercase">
                  {project.data.techStack?.[0] ?? 'UNKNOWN'}
                </span>
              </div>
              <div class={`px-2 py-1 text-[10px] font-mono border ${
                project.data.status === 'completed' 
                  ? 'border-green-500/30 text-green-500 bg-green-500/10' 
                  : 'border-amber-500/30 text-amber-500 bg-amber-500/10'
              }`}>
                {project.data.status}
              </div>
            </div>
          </a>
        ))}
      </div>
      <div class="mt-4 pt-2 border-t border-border/50 text-right">
        <a href="/about" class="text-xs font-mono text-amber-500 hover:underline">
          [ACCESS_ARCHIVES]
        </a>
      </div>
    </Panel>

    {/* FOOTER STATS / QUICK LINKS (12 Columns) */}
    <Panel class="md:col-span-12 py-3 flex justify-between items-center bg-black/20">
       <div class="flex gap-6 text-[10px] text-muted-foreground font-mono uppercase tracking-wider">
         <span>CPU: 12%</span>
         <span>MEM: 4.2GB</span>
         <span>NET: CONNECTED</span>
       </div>
       <div class="flex gap-4 text-xs font-mono">
          <a href="/cv" class="text-muted-foreground hover:text-amber-500">[RESUME]</a>
          <a href="https://github.com/alvitodev" class="text-muted-foreground hover:text-amber-500">[GITHUB]</a>
       </div>
    </Panel>

  </div>
</Layout>