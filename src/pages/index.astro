---
import Layout from '@/layouts/Layout.astro'
import Panel from '@/components/Panel.astro'
import { getAllWriting, getAllWork, formatDate } from '@/lib/data-utils'
import { getCollection, type CollectionEntry } from 'astro:content'

// Ambil 5 tulisan terbaru
const recentWriting = (await getAllWriting()).slice(0, 5)

// Ambil 3 proyek terbaru
const recentWork = (await getAllWork()).slice(0, 3)
const recentNotes = (await getCollection('notes')).slice(0, 3)
const libraryLogs = (await getCollection('library')).slice(0, 2)
---

<Layout title="Command Center" class="max-w-7xl">
  <div class="grid grid-cols-1 md:grid-cols-12 gap-4 min-h-[80vh] content-center py-10">
    
    {/* HEADER MODULE (12 Columns) */}
    <Panel class="md:col-span-12 flex flex-col md:flex-row items-center justify-between gap-4 py-8">
      <div>
        <h1 class="text-4xl font-mono font-bold text-foreground tracking-tighter">
          ALVITO<span class="text-amber-500">.DEV</span>
        </h1>
        <div class="flex gap-4 mt-2 text-xs font-mono text-muted-foreground">
          <p>&gt; SYSTEM_STATUS: <span class="text-green-500 animate-pulse">ONLINE</span></p>
          <p>&gt; LAST_LOGIN: {new Date().toLocaleTimeString()}</p>
        </div>
      </div>
      <div class="text-right hidden md:block space-y-1">
        <p class="text-xs text-muted-foreground font-mono">LOCATION: YOGYAKARTA, ID</p>
        <p class="text-xs text-muted-foreground font-mono">LAT: -7.7956 // LONG: 110.3695</p>
      </div>
    </Panel>

    {/* WRITING MODULE (7 Columns) */}
    <Panel title="// RECENT_LOGS" class="md:col-span-7 h-full">
      <ul class="space-y-1">
        {recentWriting.map((post) => (
          <li class="group/item">
            <a 
              href={`/writing/${post.id}`} 
              class="flex items-baseline justify-between py-2 border-b border-border/50 hover:pl-2 transition-all cursor-pointer"
            >
              <div class="flex items-center gap-2 overflow-hidden">
                <span class="text-amber-500 opacity-0 group-hover/item:opacity-100 transition-opacity text-xs">&gt;</span>
                <span class="text-foreground/80 hover:text-amber-500 font-mono text-sm truncate transition-colors">
                  {post.data.title}
                </span>
              </div>
              <span class="text-[10px] text-muted-foreground font-mono whitespace-nowrap pl-4">
                {formatDate(post.data.publishDate)}
              </span>
            </a>
          </li>
        ))}
      </ul>
      <div class="mt-4 pt-2 border-t border-border/50 text-right">
        <a href="/writing" class="text-xs font-mono text-amber-500 hover:underline">
          [VIEW_ALL_LOGS]
        </a>
      </div>
    </Panel>

    {/* WORK MODULE (5 Columns) */}
    <Panel title="// ACTIVE_TASKS" class="md:col-span-5 h-full flex flex-col">
      <div class="space-y-3 grow">
        {recentWork.map((project) => (
          <a href={project.data.demoLink || project.data.repoLink || '#'} class="block group">
            <div class="flex items-center justify-between bg-secondary/20 p-3 border border-border group-hover:border-amber-500/50 transition-colors">
              <div class="flex flex-col gap-1">
                <span class="text-foreground text-sm font-bold truncate">{project.data.title}</span>
                <span class="text-[10px] text-muted-foreground font-mono uppercase">
                  {project.data.techStack?.[0] ?? 'UNKNOWN'}
                </span>
              </div>
              <div class={`px-2 py-1 text-[10px] font-mono border ${
                project.data.status === 'completed' 
                  ? 'border-green-500/30 text-green-500 bg-green-500/10' 
                  : 'border-amber-500/30 text-amber-500 bg-amber-500/10'
              }`}>
                {project.data.status}
              </div>
            </div>
          </a>
        ))}
      </div>
      <div class="mt-4 pt-2 border-t border-border/50 text-right">
        <a href="/about" class="text-xs font-mono text-amber-500 hover:underline">
          [ACCESS_ARCHIVES]
        </a>
      </div>
    </Panel>


    {/* MODULE: NOTES (4 Cols) */}
        <Panel title="// QUICK_SNIPPETS" class="md:col-span-4 h-full">
            <ul class="space-y-3">
                {recentNotes.map(note => (
                     <li class="font-mono text-xs text-zinc-400 border-b border-zinc-800 pb-2 hover:pl-2 transition-all">
                        <a href={`/notes/${note.id}`} class="hover:text-amber-500">
                            {note.data.title}
                        </a>
                     </li>
                ))}
            </ul>
            <div class="mt-4 pt-2 border-t border-border/50 text-right">
                <a href="/notes" class="text-xs font-mono text-amber-500 hover:underline">[VIEW_ALL_SNIPPETS]</a>
            </div>
        </Panel>
        
        {/* MODULE: LIBRARY (4 Cols) */}
        <Panel title="// MEDIA_LOG" class="md:col-span-4 h-full">
            <div class="space-y-3">
                {libraryLogs.map(item => (
                    <div class="font-mono text-xs text-zinc-400 flex justify-between p-2 border border-zinc-800">
                        <span class="text-white font-bold uppercase">{item.data.title}</span>
                        <span class="text-amber-500 uppercase">{item.data.type}</span>
                    </div>
                ))}
            </div>
             <div class="mt-4 pt-2 border-t border-border/50 text-right">
                <a href="/library" class="text-xs font-mono text-amber-500 hover:underline">[ACCESS_LIBRARY]</a>
            </div>
        </Panel>
        
        {/* MODULE: GALLERY & FEED (4 Cols) */}
        <Panel title="// SYSTEM_STATS_&_LINKS" class="md:col-span-4 h-full flex flex-col justify-between">
            <div class="space-y-3">
                <p class="text-xs font-mono text-zinc-500">
                    &gt; CORE_TEMPERATURE: <span class="text-green-500">35C</span>
                </p>
                 <p class="text-xs font-mono text-zinc-500">
                    &gt; NEXT_UPDATE_CYCLE: <span class="text-amber-500">T-30 DAYS</span>
                </p>
            </div>
            
            <div class="pt-4 border-t border-border/50 flex flex-col gap-2">
                <a href="/gallery" class="text-xs font-mono text-zinc-400 hover:text-amber-500">[VIEW_GALLERY_DATABANKS]</a>
                <a href="/feed" class="text-xs font-mono text-zinc-400 hover:text-amber-500">[VIEW_LIVE_FEED]</a>
                <a href="/cv" class="text-xs font-mono text-zinc-400 hover:text-amber-500">[ACCESS_RESUME]</a>
            </div>
        </Panel>
        
        {/* FOOTER STATS (Paling Bawah, 12 Cols) - Pindahkan kode stats lama ke sini jika perlu */}
        {/* (Di sini kita kosongkan/buat minimalis agar tidak bertumpuk dengan footer global) */}

  </div>
</Layout>