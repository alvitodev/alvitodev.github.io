---
import { getCollection, render } from 'astro:content';
import Layout from '@/layouts/Layout.astro';
import Panel from '@/components/Panel.astro';
import { formatDate } from '@/lib/data-utils';
import { Icon } from 'astro-icon/components';

// Generate Static Paths
export async function getStaticPaths() {
  const notes = await getCollection('notes');
  return notes.map((note) => ({
    params: { id: note.id },
    props: { note },
  }));
}

const { note } = Astro.props;
const { Content } = await render(note);
---

<Layout title={note.data.title}>
  <div class="max-w-3xl mx-auto p-4 md:p-8 min-h-screen">
    
    {/* Navigasi Kembali */}
    <div class="mb-6">
      <a href="/notes" class="text-xs font-mono text-zinc-500 hover:text-amber-500 transition-colors">
        &lt; BACK_TO_SNIPPETS
      </a>
    </div>

    {/* KONTEN UTAMA */}
    <Panel class="min-h-[60vh] p-8">
      
      {/* Header Artikel */}
      <header class="border-b border-zinc-800 pb-6 mb-8">
        <div class="flex flex-wrap gap-4 items-center text-xs font-mono text-zinc-500 mb-4">
          <span class="text-amber-500">ID: {note.id}</span>
          <span>//</span>
          <span>{formatDate(note.data.publishDate)}</span>
        </div>
        
        <h1 class="text-3xl font-bold font-mono text-white tracking-tight">
          {note.data.title}
        </h1>

        {/* Tags */}
        <div class="flex gap-2 mt-4">
          {(note.data.tags ?? []).map((tag) => (
            <span class="font-mono text-xs border border-zinc-700 px-2 py-1 rounded text-zinc-400 bg-zinc-950">
              <Icon name="lucide:hash" class="size-3 mr-1 inline-block" />
              {tag}
            </span>
          ))}
        </div>
      </header>

      {/* Render Markdown Content */}
      <article class="prose prose-invert prose-zinc max-w-none prose-headings:font-mono prose-p:text-zinc-400 prose-pre:border prose-pre:border-zinc-800 prose-pre:bg-zinc-950">
        <Content />
      </article>

      {/* Footer Artikel */}
      <div class="mt-12 pt-6 border-t border-zinc-800 text-center">
        <p class="text-xs font-mono text-zinc-600">
          *** END_OF_NOTE ***
        </p>
      </div>

    </Panel>
  </div>
</Layout>