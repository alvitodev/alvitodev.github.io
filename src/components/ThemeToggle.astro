---
import { Icon } from 'astro-icon/components'
---

<button
  id="theme-toggle"
  type="button"
  class="relative inline-flex h-9 w-9 items-center justify-center rounded-md border border-zinc-200 bg-transparent text-zinc-500 hover:bg-zinc-100 hover:text-zinc-900 focus-visible:ring-1 focus-visible:ring-zinc-950 disabled:pointer-events-none disabled:opacity-50 dark:border-zinc-800 dark:text-zinc-400 dark:hover:bg-zinc-800 dark:hover:text-zinc-50 dark:focus-visible:ring-zinc-300 transition-colors"
  aria-label="Toggle theme"
>
  <Icon
    name="lucide:sun"
    class="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"
  />
  <Icon
    name="lucide:moon"
    class="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"
  />
</button>

<script is:inline>
  function setupThemeToggle() {
    const button = document.getElementById("theme-toggle");
    
    // Fungsi toggle
    const handleToggleClick = () => {
      const element = document.documentElement;
      element.classList.toggle("dark");

      const isDark = element.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      
      // Update atribut data-theme juga untuk CSS selector
      element.setAttribute('data-theme', isDark ? 'dark' : 'light');
    };

    // Bersihkan listener lama (jika ada) untuk mencegah duplikasi
    button?.removeEventListener("click", handleToggleClick);
    
    // Pasang listener baru
    button?.addEventListener("click", handleToggleClick);
  }

  // Jalankan saat load awal
  setupThemeToggle();

  // Jalankan ulang saat navigasi (jika pakai View Transitions)
  document.addEventListener('astro:page-load', setupThemeToggle);
</script>