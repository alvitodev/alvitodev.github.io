<!DOCTYPE html><html lang="id-ID" class="scroll-smooth"> <head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"><meta name="generator" content="Astro v5.16.4"><!-- Canonical URL --><link rel="canonical" href="https://alvitodev.github.io/writing/rehype-patch/"><!-- Primary Meta Tags --><title>v1.3.0: ‚ÄúPatches in Production‚Äù | Alvito.dev</title><meta name="title" content="v1.3.0: ‚ÄúPatches in Production‚Äù | Alvito.dev"><meta name="description" content="Whenever you depend on Node packages with missing maintainers, patching becomes a necessary evil."><meta name="author" content="Muhammad Alvito Devanova"><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://alvitodev.github.io/writing/rehype-patch/"><meta property="og:title" content="v1.3.0: ‚ÄúPatches in Production‚Äù | Alvito.dev"><meta property="og:description" content="Whenever you depend on Node packages with missing maintainers, patching becomes a necessary evil."><meta property="og:image" content="https://alvitodev.github.io/static/1200x630.png"><meta property="og:site_name" content="Alvito.dev"><meta property="og:locale" content="id-ID"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://alvitodev.github.io/writing/rehype-patch/"><meta property="twitter:title" content="v1.3.0: ‚ÄúPatches in Production‚Äù | Alvito.dev"><meta property="twitter:description" content="Whenever you depend on Node packages with missing maintainers, patching becomes a necessary evil."><meta property="twitter:image" content="https://alvitodev.github.io/static/1200x630.png"><meta property="twitter:creator" content="@alvitodev"><!-- JSON-LD Structured Data --><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"v1.3.0: ‚ÄúPatches in Production‚Äù","description":"Whenever you depend on Node packages with missing maintainers, patching becomes a necessary evil.","image":"https://alvitodev.github.io/static/1200x630.png","author":{"@type":"Person","name":"Muhammad Alvito Devanova","url":"https://alvitodev.github.io/"},"datePublished":"2024-03-19T00:00:00.000Z","dateModified":"2024-03-19T00:00:00.000Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://alvitodev.github.io/writing/rehype-patch/"}}</script><!-- Mobile & PWA --><meta name="HandheldFriendly" content="True"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="format-detection" content="telephone=no,date=no,address=no,email=no,url=no"><meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)"><meta name="theme-color" content="#121212" media="(prefers-color-scheme: light)"><link rel="sitemap" href="/sitemap-index.xml"><link rel="manifest" href="/site.webmanifest"><link rel="alternate" type="application/rss+xml" title="Alvito.dev" href="https://alvitodev.github.io/rss.xml"><link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="shortcut icon" href="/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><meta name="apple-mobile-web-app-title" content="astro-erudite"><link rel="manifest" href="/site.webmanifest"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.QW52Ox2j.js"></script><link rel="stylesheet" href="/_astro/about.BA91I8cj.css"><script type="module" src="/_astro/page.lxGFV7-1.js"></script></head><script>
    (function() {
      const getThemePreference = () => {
        if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
          return localStorage.getItem('theme');
        }
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      };
      const isDark = getThemePreference() === 'dark';
      document.documentElement.classList[isDark ? 'add' : 'remove']('dark');
      document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
      document.documentElement.style.colorScheme = isDark ? 'dark' : 'light';
    })();
  </script><body class="flex h-fit min-h-screen flex-col font-sans bg-background text-foreground antialiased relative selection:bg-yellow-500/30"> <div class="fixed inset-0 pointer-events-none z-[1] vignette-layer"></div> <header class="sticky top-0 z-50 w-full border-b border-border bg-background/80 backdrop-blur-md transition-colors duration-300"> <div class="mx-auto flex w-full max-w-7xl items-center justify-between px-4 py-3">  <a href="/" class="group flex items-center gap-2"> <div class="relative flex h-6 w-6 items-center justify-center overflow-hidden border border-zinc-400 bg-zinc-200 transition-colors group-hover:border-yellow-500 dark:border-zinc-700 dark:bg-zinc-900"> <span class="dark:group-hover:text-foreground font-mono text-xs font-bold text-yellow-600 group-hover:text-yellow-700 dark:text-yellow-500">A</span> <div class="absolute top-0 right-0 h-1.5 w-1.5 border-b border-l border-zinc-400 bg-zinc-100 dark:border-zinc-700 dark:bg-zinc-950"></div> </div> <span class="dark:group-hover:text-foreground font-mono text-sm font-bold tracking-tighter text-zinc-700 transition-colors group-hover:text-black dark:text-zinc-300">
ALVITO<span class="text-yellow-600 dark:text-yellow-500">.DEV</span> </span> </a>  <nav class="flex items-center gap-2 sm:gap-4"> <a href="/" class="relative px-3 py-1.5 font-mono text-[10px] tracking-widest transition-all duration-300 sm:text-xs border border-transparent text-zinc-500 hover:bg-zinc-200/50 hover:text-zinc-900 dark:hover:bg-zinc-800/50 dark:hover:text-zinc-200 "> HOME  </a><a href="/writing" class="relative px-3 py-1.5 font-mono text-[10px] tracking-widest transition-all duration-300 sm:text-xs border border-yellow-500/50 bg-yellow-500/10 font-bold text-yellow-600 dark:text-yellow-500 "> WRITING <span class="absolute -top-0.5 -right-0.5 h-1.5 w-1.5 animate-pulse rounded-full bg-yellow-500 shadow-[0_0_8px_rgba(245,158,11,0.8)]"></span> </a><a href="/work" class="relative px-3 py-1.5 font-mono text-[10px] tracking-widest transition-all duration-300 sm:text-xs border border-transparent text-zinc-500 hover:bg-zinc-200/50 hover:text-zinc-900 dark:hover:bg-zinc-800/50 dark:hover:text-zinc-200 "> WORK  </a><a href="/notes" class="relative px-3 py-1.5 font-mono text-[10px] tracking-widest transition-all duration-300 sm:text-xs border border-transparent text-zinc-500 hover:bg-zinc-200/50 hover:text-zinc-900 dark:hover:bg-zinc-800/50 dark:hover:text-zinc-200 "> NOTES  </a><a href="/feed" class="relative px-3 py-1.5 font-mono text-[10px] tracking-widest transition-all duration-300 sm:text-xs border border-transparent text-zinc-500 hover:bg-zinc-200/50 hover:text-zinc-900 dark:hover:bg-zinc-800/50 dark:hover:text-zinc-200 "> FEED  </a><a href="/library" class="relative px-3 py-1.5 font-mono text-[10px] tracking-widest transition-all duration-300 sm:text-xs border border-transparent text-zinc-500 hover:bg-zinc-200/50 hover:text-zinc-900 dark:hover:bg-zinc-800/50 dark:hover:text-zinc-200 "> LIBRARY  </a><a href="/gallery" class="relative px-3 py-1.5 font-mono text-[10px] tracking-widest transition-all duration-300 sm:text-xs border border-transparent text-zinc-500 hover:bg-zinc-200/50 hover:text-zinc-900 dark:hover:bg-zinc-800/50 dark:hover:text-zinc-200 "> GALLERY  </a><a href="/about" class="relative px-3 py-1.5 font-mono text-[10px] tracking-widest transition-all duration-300 sm:text-xs border border-transparent text-zinc-500 hover:bg-zinc-200/50 hover:text-zinc-900 dark:hover:bg-zinc-800/50 dark:hover:text-zinc-200 "> ABOUT  </a>  <div class="mx-1 hidden h-4 w-[1px] bg-zinc-300 sm:block dark:bg-zinc-800"></div>  <div class="scale-90"> <button id="theme-toggle" type="button" class="relative inline-flex h-9 w-9 items-center justify-center rounded-md border border-zinc-200 bg-transparent text-zinc-500 transition-colors hover:bg-zinc-100 hover:text-zinc-900 focus-visible:ring-1 focus-visible:ring-zinc-950 disabled:pointer-events-none disabled:opacity-50 dark:border-zinc-800 dark:text-zinc-400 dark:hover:bg-zinc-800 dark:hover:text-zinc-50 dark:focus-visible:ring-zinc-300" aria-label="Toggle theme"> <svg width="1em" height="1em" class="h-[1.2rem] w-[1.2rem] scale-100 rotate-0 transition-all dark:scale-0 dark:-rotate-90" data-icon="lucide:sun">   <symbol id="ai:lucide:sun" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></g></symbol><use href="#ai:lucide:sun"></use>  </svg> <svg width="1em" height="1em" class="absolute h-[1.2rem] w-[1.2rem] scale-0 rotate-90 transition-all dark:scale-100 dark:rotate-0" data-icon="lucide:moon">   <symbol id="ai:lucide:moon" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401"/></symbol><use href="#ai:lucide:moon"></use>  </svg> </button> <script>
  function setupThemeToggle() {
    const button = document.getElementById('theme-toggle')
    // Sync initial theme from storage or system preference
    const applyTheme = (theme) => {
      const element = document.documentElement
      const isDark = theme === 'dark'
      if (isDark) element.classList.add('dark')
      else element.classList.remove('dark')
      element.setAttribute('data-theme', isDark ? 'dark' : 'light')
      element.style.colorScheme = isDark ? 'dark' : 'light'
    }

    const getStoredTheme = () => {
      try {
        const t = localStorage.getItem('theme')
        if (t === 'dark' || t === 'light') return t
      } catch (e) {}
      return window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light'
    }

    // Apply stored theme immediately (important for client-side navigations)
    try {
      applyTheme(getStoredTheme())
    } catch (e) {}

    // Fungsi toggle
    const handleToggleClick = () => {
      const element = document.documentElement
      element.classList.toggle('dark')

      const isDark = element.classList.contains('dark')
      try {
        localStorage.setItem('theme', isDark ? 'dark' : 'light')
      } catch (e) {}

      // Update atribut data-theme juga untuk CSS selector
      element.setAttribute('data-theme', isDark ? 'dark' : 'light')

      // üîë PENTING: Trigger repaint agar CSS variables terupdate dengan baik
      // Ini memastikan vignette, grid, dan semua elemen lain switch tema dengan smooth
      element.style.colorScheme = isDark ? 'dark' : 'light'
    }

    // Tambahkan listener sekali saja per button instance
    if (button && !button.dataset.themeInit) {
      button.addEventListener('click', handleToggleClick)
      button.dataset.themeInit = 'true'
    }
  }

  // Jalankan saat load awal
  setupThemeToggle()

  // Jalankan ulang saat navigasi (jika pakai View Transitions)
  document.addEventListener('astro:page-load', setupThemeToggle)
</script> </div> </nav> </div> <div class="contents [&:not(:empty)]:block [&:not(:empty)]:border-t [&:not(:empty)]:border-border">  <div id="mobile-toc-container" class="w-full xl:hidden"><details class="group"><summary class="flex w-full cursor-pointer items-center justify-between"><div class="mx-auto flex w-full max-w-3xl items-center px-4 py-3"><div class="relative mr-2 size-4"><svg class="h-4 w-4" viewBox="0 0 24 24"><circle class="text-primary/20" cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"></circle><circle id="mobile-toc-progress-circle" class="text-primary" cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="62.83" stroke-dashoffset="62.83" transform="rotate(-90 12 12)"></circle></svg></div><span id="mobile-toc-current-section" class="text-muted-foreground flex-grow truncate text-sm">
Overview
</span><span class="text-muted-foreground ml-2"><svg width="1em" height="1em" class="h-4 w-4 transition-transform duration-200 group-open:rotate-180" data-icon="lucide:chevron-down">   <symbol id="ai:lucide:chevron-down" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9l6 6l6-6"/></symbol><use href="#ai:lucide:chevron-down"></use>  </svg></span></div></summary><style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="cdYwX" prefix="r7" component-url="/_astro/scroll-area.SV-Nx2Ro.js" component-export="ScrollArea" renderer-url="/_astro/client.i8_f7Fkk.js" props="{&quot;className&quot;:[0,&quot;mx-auto max-w-3xl&quot;],&quot;data-toc-header-scroll&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;ScrollArea&quot;,&quot;value&quot;:true}" await-children><div dir="ltr" data-slot="scroll-area" class="relative mx-auto max-w-3xl" data-toc-header-scroll="true" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><astro-slot><div class="max-h-[30vh]"><ul class="flex list-none flex-col gap-y-2 px-4 pb-4" id="mobile-table-of-contents"><li class="px-4 text-sm text-foreground/60"><a href="#a-problem-about-dead-maintainers" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="a-problem-about-dead-maintainers">A problem (about dead maintainers)</a></li><li class="px-4 text-sm text-foreground/60"><a href="#the-hunt-for-a-solution" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="the-hunt-for-a-solution">The hunt for a solution</a></li><li class="px-4 text-sm text-foreground/60"><a href="#performing-surgery-on-node_modules" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="performing-surgery-on-node_modules">Performing surgery on node_modules</a></li><li class="px-4 text-sm text-foreground/60"><a href="#please-dont-perform-surgery-on-your-node_modules" class="mobile-toc-item underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-id="please-dont-perform-surgery-on-your-node_modules">Please don‚Äôt perform surgery on your node_modules</a></li></ul></div></astro-slot></div></div></div><!--astro:end--></astro-island></details></div><script type="module" src="/_astro/TOCHeader.astro_astro_type_script_index_0_lang.CKMLAwWj.js"></script> </div> </header> <main class="w-full mx-auto flex grow flex-col gap-y-6 px-4 relative z-10"> <section class="grid grid-cols-[minmax(0px,1fr)_min(calc(var(--breakpoint-md)-2rem),100%)_minmax(0px,1fr)] gap-y-6 lg:gap-y-8">  <div class="col-start-2 pt-6"> <nav aria-label="breadcrumb" data-slot="breadcrumb"> <ol data-slot="breadcrumb-list" class="text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5"> <li data-slot="breadcrumb-item" class="inline-flex items-center gap-1.5"> <a data-slot="breadcrumb-link" class="hover:text-foreground transition-colors" href="/"> <svg width="1em" height="1em" class="size-4 shrink-0" data-icon="lucide:home">   <symbol id="ai:lucide:home" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"/><path d="M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></g></symbol><use href="#ai:lucide:home"></use>  </svg> </a> </li>  <li data-slot="breadcrumb-separator" role="presentation" aria-hidden="true" class="[&amp;&gt;svg]:size-3.5"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right"><path d="m9 18 6-6-6-6"></path></svg></li> <li data-slot="breadcrumb-item" class="inline-flex items-center gap-1.5"><a data-slot="breadcrumb-link" class="hover:text-foreground transition-colors" href="/writing"> <span class="flex items-center gap-x-2"> <svg width="1em" height="1em" class="size-4 shrink-0" data-icon="lucide:terminal">   <symbol id="ai:lucide:terminal" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19h8M4 17l6-6l-6-6"/></symbol><use href="#ai:lucide:terminal"></use>  </svg> <span>Writing</span> </span> </a></li>  <li data-slot="breadcrumb-separator" role="presentation" aria-hidden="true" class="[&amp;&gt;svg]:size-3.5"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right"><path d="m9 18 6-6-6-6"></path></svg></li> <li data-slot="breadcrumb-item" class="inline-flex items-center gap-1.5"><span data-slot="breadcrumb-page" role="link" aria-disabled="true" aria-current="page" class="text-foreground font-normal"> <span class="flex items-center gap-x-2"> <svg width="1em" height="1em" class="size-4 shrink-0" data-icon="lucide:book-open-text">   <symbol id="ai:lucide:book-open-text" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 7v14m4-9h2m-2-4h2M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4a4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3a3 3 0 0 0-3-3zm3-6h2M6 8h2"/></symbol><use href="#ai:lucide:book-open-text"></use>  </svg> <span>v1.3.0: ‚ÄúPatches in Production‚Äù</span> </span> </span></li> </ol> </nav> </div>    <section class="col-start-2 flex flex-col gap-y-6 text-center pt-2"> <div class="flex flex-col"> <h1 class="mb-4 scroll-mt-31 text-3xl font-bold font-mono tracking-tight sm:text-5xl text-foreground" id="post-title"> v1.3.0: ‚ÄúPatches in Production‚Äù </h1> <div class="text-muted-foreground divide-border mb-6 flex flex-col items-center justify-center divide-y text-xs font-mono sm:flex-row sm:flex-wrap sm:divide-x sm:divide-y-0">  <!-- {
            authors.length > 0 && (
              <div class="flex w-full items-center justify-center gap-x-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0">
                {authors.map((author) => (
                  <div class="flex items-center gap-x-1.5">
                    {/* ... author logic ... */}
                    <span>{author.name}</span>
                  </div>
                ))}
              </div>
            )
          } -->  <div class="flex w-full items-center justify-center gap-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0 text-yellow-500"> <svg width="1em" height="1em" class="size-3" data-icon="lucide:calendar">   <symbol id="ai:lucide:calendar" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M8 2v4m8-4v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></g></symbol><use href="#ai:lucide:calendar"></use>  </svg> <span>March 19, 2024</span> /* FIX: date -> publishDate */
</div>  <div class="flex w-full items-center justify-center gap-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0"> <span> 0 min read  </span> </div>   </div>  <div class="flex flex-wrap justify-center gap-2"> <span class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&#38;>svg]:size-3 gap-1 [&#38;>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden text-foreground [a&#38;]:hover:bg-muted [a&#38;]:hover:text-foreground font-mono text-xs border-border text-muted-foreground"> <svg width="1em" height="1em" class="size-3 mr-1" data-icon="lucide:hash">   <symbol id="ai:lucide:hash" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 9h16M4 15h16M10 3L8 21m8-18l-2 18"/></symbol><use href="#ai:lucide:hash"></use>  </svg> v1.3.0 </span> </div> </div> <div class="mt-8 flex flex-col gap-4 border-t border-zinc-800 pt-8 sm:flex-row sm:justify-between"> <a href="/writing/the-state-of-static-blogs" class="group flex flex-col gap-1 text-left sm:max-w-[45%]"> <span class="flex items-center gap-1 font-mono text-xs text-zinc-500 transition-colors group-hover:text-yellow-500"> <svg width="1em" height="1em" class="size-3" data-icon="lucide:arrow-left">   <symbol id="ai:lucide:arrow-left" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m12 19l-7-7l7-7m7 7H5"/></symbol><use href="#ai:lucide:arrow-left"></use>  </svg>
PREVIOUS_LOG
</span> <span class="group-hover:text-foreground line-clamp-2 text-sm font-bold text-zinc-300 transition-colors"> The State of Static Blogs in 2024 </span> </a> <a href="/writing/mobile-nav-and-subposts" class="group flex flex-col gap-1 text-right sm:max-w-[45%]"> <span class="flex items-center justify-end gap-1 font-mono text-xs text-zinc-500 transition-colors group-hover:text-yellow-500">
NEXT_LOG
<svg width="1em" height="1em" class="size-3" data-icon="lucide:arrow-right">   <symbol id="ai:lucide:arrow-right" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7-7l7 7l-7 7"/></symbol><use href="#ai:lucide:arrow-right"></use>  </svg> </span> <span class="group-hover:text-foreground line-clamp-2 text-sm font-bold text-zinc-300 transition-colors"> v1.6.0: &quot;Mobile Navigation &amp; Subposts&quot; </span> </a> </div> </section>  <div id="toc-sidebar-container" class="sticky top-20 col-start-1 row-span-1 mr-8 ml-auto hidden h-[calc(100vh-5rem)] max-w-md xl:block"><astro-island uid="Z2jAkpR" prefix="r12" component-url="/_astro/scroll-area.SV-Nx2Ro.js" component-export="ScrollArea" renderer-url="/_astro/client.i8_f7Fkk.js" props="{&quot;className&quot;:[0,&quot;flex max-h-[calc(100vh-8rem)] flex-col overflow-y-auto&quot;],&quot;type&quot;:[0,&quot;hover&quot;],&quot;data-toc-scroll-area&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;ScrollArea&quot;,&quot;value&quot;:true}" await-children><div dir="ltr" data-slot="scroll-area" class="relative flex max-h-[calc(100vh-8rem)] flex-col overflow-y-auto" data-toc-scroll-area="true" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" data-slot="scroll-area-viewport" class="ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><astro-slot><div class="flex flex-col gap-2 px-4"><span class="text-lg font-medium">Table of Contents</span><ul class="flex list-none flex-col gap-y-2"><li class="text-sm text-foreground/60"><a href="#a-problem-about-dead-maintainers" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="a-problem-about-dead-maintainers">A problem (about dead maintainers)</a></li><li class="text-sm text-foreground/60"><a href="#the-hunt-for-a-solution" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="the-hunt-for-a-solution">The hunt for a solution</a></li><li class="text-sm text-foreground/60"><a href="#performing-surgery-on-node_modules" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="performing-surgery-on-node_modules">Performing surgery on node_modules</a></li><li class="text-sm text-foreground/60"><a href="#please-dont-perform-surgery-on-your-node_modules" class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit" data-heading-link="please-dont-perform-surgery-on-your-node_modules">Please don‚Äôt perform surgery on your node_modules</a></li></ul></div></astro-slot></div></div></div><!--astro:end--></astro-island></div><script type="module">class f{links=document.querySelectorAll("[data-heading-link]");activeIds=[];headings=[];regions=[];scrollArea=null;tocScrollArea=null;reset(){this.links=document.querySelectorAll("#toc-sidebar-container [data-heading-link]"),this.activeIds=[],this.headings=[],this.regions=[];const t=document.getElementById("toc-sidebar-container");this.scrollArea=t?.querySelector("[data-radix-scroll-area-viewport]")||null,this.tocScrollArea=t?.querySelector("[data-toc-scroll-area]")||null}}const e=new f;class c{static build(){if(e.headings=Array.from(document.querySelectorAll(".prose h2, .prose h3, .prose h4, .prose h5, .prose h6")),e.headings.length===0){e.regions=[];return}e.regions=e.headings.map((t,o)=>{const i=e.headings[o+1];return{id:t.id,start:t.offsetTop,end:i?i.offsetTop:document.body.scrollHeight}})}static getVisibleIds(){if(e.headings.length===0)return[];const t=window.scrollY+150,o=window.scrollY+window.innerHeight,i=new Set,l=(s,r)=>s>=t&&s<=o||r>=t&&r<=o||s<=t&&r>=o;return e.headings.forEach(s=>{const r=s.offsetTop+s.offsetHeight;l(s.offsetTop,r)&&i.add(s.id)}),e.regions.forEach(s=>{if(s.start<=o&&s.end>=t){const r=document.getElementById(s.id);if(r){const a=r.offsetTop+r.offsetHeight;s.end>a&&(a<o||t<s.end)&&i.add(s.id)}}}),Array.from(i)}}class h{static update(){if(!e.scrollArea||!e.tocScrollArea)return;const{scrollTop:t,scrollHeight:o,clientHeight:i}=e.scrollArea,l=5,s=t<=l,r=t>=o-i-l;e.tocScrollArea.classList.toggle("mask-t-from-90%",!s),e.tocScrollArea.classList.toggle("mask-b-from-90%",!r)}}class g{static update(t){e.links.forEach(o=>{o.classList.remove("text-foreground")}),t.forEach(o=>{if(o){const i=document.querySelector(`#toc-sidebar-container [data-heading-link="${o}"]`);i&&i.classList.add("text-foreground")}}),this.scrollToActive(t)}static scrollToActive(t){if(!e.scrollArea||!t.length)return;const o=document.querySelector(`#toc-sidebar-container [data-heading-link="${t[0]}"]`);if(!o)return;const{top:i,height:l}=e.scrollArea.getBoundingClientRect(),{top:s,height:r}=o.getBoundingClientRect(),a=s-i+e.scrollArea.scrollTop,u=Math.max(0,Math.min(a-(l-r)/2,e.scrollArea.scrollHeight-e.scrollArea.clientHeight));Math.abs(u-e.scrollArea.scrollTop)>5&&(e.scrollArea.scrollTop=u)}}class d{static handleScroll(){const t=c.getVisibleIds();JSON.stringify(t)!==JSON.stringify(e.activeIds)&&(e.activeIds=t,g.update(e.activeIds))}static handleTOCScroll=()=>h.update();static handleResize(){c.build();const t=c.getVisibleIds();JSON.stringify(t)!==JSON.stringify(e.activeIds)&&(e.activeIds=t,g.update(e.activeIds)),h.update()}static init(){if(e.reset(),c.build(),e.headings.length===0){g.update([]);return}this.handleScroll(),setTimeout(h.update,100);const t={passive:!0};window.addEventListener("scroll",this.handleScroll,t),window.addEventListener("resize",this.handleResize,t),e.scrollArea?.addEventListener("scroll",this.handleTOCScroll,t)}static cleanup(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize),e.scrollArea?.removeEventListener("scroll",this.handleTOCScroll),Object.assign(e,{activeIds:[],headings:[],regions:[],scrollArea:null,tocScrollArea:null})}}document.addEventListener("astro:page-load",()=>d.init());document.addEventListener("astro:after-swap",()=>{d.cleanup(),d.init()});document.addEventListener("astro:before-swap",()=>d.cleanup());</script>  <article class="prose dark:prose-invert prose-zinc col-start-2 max-w-none prose-headings:font-mono prose-headings:tracking-tight prose-a:text-yellow-600 dark:prose-a:text-yellow-500 prose-code:text-yellow-600 dark:prose-code:text-yellow-300 prose-pre:border prose-pre:border-border prose-pre:bg-muted/50"> <h2 id="a-problem-about-dead-maintainers">A problem (about dead maintainers)</h2>
<p>This post talks about changes I‚Äôve made to astro-erudite in v1.3.0!</p>
<p>I recently found myself caught between two syntax highlighting packages that I absolutely needed for astro-erudite. On one hand, the current template uses <a href="https://rehype-pretty.pages.dev/" rel="nofollow noreferrer noopener" target="_blank">rehype-pretty-code</a> as its main syntax highlighting solution, but due to issues with its inherent implementation and missing features that I needed, I had created a bunch of custom transformers to make it do what I wanted, and the whole setup was getting unwieldy. I then discovered <a href="https://expressive-code.com/" rel="nofollow noreferrer noopener" target="_blank">Expressive Code</a>, which had everything I wanted out of the box‚Äîcollapsible code sections, terminal and editor frames, gutter comments‚Äîit was perfect! Well, almost perfect.</p>
<p>The primary issue was that Expressive Code doesn‚Äôt support inline syntax highlighting, which is non-negotiable for me since I need my inline code snippets to look as good as my code blocks (so I could do stuff like <code>console.log(&quot;Hello, world!&quot;.split(&#39;&#39;).reverse().join(&#39;&#39;)){:js}</code>). So I opened a feature request at <a href="https://github.com/expressive-code/expressive-code/issues/250" rel="nofollow noreferrer noopener" target="_blank">expressive-code/expressive-code#250</a> and the maintainer seemed interested, saying they‚Äôd get around to it eventually. Implementing this feature is a lot easier said than done though, and I summarized it well in another thread:</p>
<blockquote>
<p><a href="https://github.com/rehype-pretty/rehype-pretty-code/issues/247#issuecomment-2619869436" rel="nofollow noreferrer noopener" target="_blank">@jktrn</a>: [‚Ä¶] expressive-code is already interested in implementing inline code support, but it would be a bit nuanced to add since it has to:</p>
<ul>
<li>allow existing plugins to continue working normally with block-level code (without breaking changes),</li>
<li>enable new plugins to explicitly declare support for inline code,</li>
<li>and provide ways for plugins to distinguish between inline and block-level code processing.</li>
</ul>
</blockquote>
<p>However, I needed a solution immediately. My first thought was to use both packages together‚ÄîExpressive Code for block code and rehype-pretty-code for inline code. However, importing both at the same time caused everything to break spectacularly.</p>
<h2 id="the-hunt-for-a-solution">The hunt for a solution</h2>
<p>Digging into the rehype-pretty-code docs, I noticed they had a <code>bypassInlineCode{:js}</code> option that lets you skip inline code highlighting (it was actually added in a really recent update). But what I needed was the opposite, which would be a way to make it only handle inline code and bypass blocks entirely.</p>
<p>So I opened a feature request at <a href="https://github.com/rehype-pretty/rehype-pretty-code/issues/247" rel="nofollow noreferrer noopener" target="_blank">rehype-pretty/rehype-pretty-code#247</a> for a theoretical <code>bypassBlockCode{:js}</code> option. I got no response, since the repository seemed unmaintained for a bit since it seems like the maintainer has moved onto other projects.</p>
<p>Fast forward a few months, and user <a href="https://github.com/kelvindecosta" rel="nofollow noreferrer noopener" target="_blank">@kelvindecosta</a> comments on my issue:</p>
<blockquote>
<p><a href="https://github.com/rehype-pretty/rehype-pretty-code/issues/247#issuecomment-2610536000" rel="nofollow noreferrer noopener" target="_blank">[@kelvindecosta]</a>: Hey <a href="https://github.com/jktrn" rel="nofollow noreferrer noopener" target="_blank">@jktrn</a>, did you figure out a workaround for this? I‚Äôm interested in setting this up alongside expressive-code.</p>
</blockquote>
<p>After I replied that I hadn‚Äôt figured out a workaround yet, they sent me a brilliantly hacky solution a couple days later:</p>
<blockquote>
<p><a href="https://github.com/rehype-pretty/rehype-pretty-code/issues/247#issuecomment-2619666231" rel="nofollow noreferrer noopener" target="_blank">[@kelvindecosta]</a>: Hey again @jktrn, I have found an unconventional way to achieve this.</p>
<p>If you‚Äôre using pnpm or bun, you can use their patch functionality to customize the contents of the <code>node_modules/rehype-pretty-code</code> package.</p>
<p>I only recently learned about this feature, and it is a good workaround for the time being. Here are the steps:</p>
<ol>
<li>Run <code>pnpm patch rehype-pretty-code</code>. This will instruct you to edit the files in a certain directory.</li>
<li>Patch out the <code>isBlockCode{:js}</code> function to always return <code>false{:js}</code>. This will instruct the plugin to not process any block code elements.</li>
<li>Run <code>pnpm patch-commit &lt;path/to/files&gt;</code>. This will create a nice patches folder with the right changes.</li>
</ol>
</blockquote>
<h2 id="performing-surgery-on-node_modules">Performing surgery on node_modules</h2>
<p>This happened to be exactly what I needed! I went into my <code>node_modules</code> directory and made the changes manually:</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.jdn72.css"/><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame has-title"><figcaption class="header"><span class="title">node_modules/rehype-pretty-code/dist/index.js</span></figcaption><pre data-language="js" class="wrap" style="--ecMaxLine:179ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">function</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">isInlineCode</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#AE4B07;--1:#FFAB70">element</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#AE4B07;--1:#FFAB70">parent</span><span style="--0:#24292E;--1:#E1E4E8">, </span><span style="--0:#AE4B07;--1:#FFAB70">bypass</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">=</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">false</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">if</span><span style="--0:#24292E;--1:#E1E4E8"> (bypass) {</span></div></div><div class="ec-line" style="--ecIndent:4ch"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#005CC5;--1:#79B8FF">false</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">  </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">  </span><span style="--0:#BF3441;--1:#F97583">return</span><span style="--0:#24292E;--1:#E1E4E8"> element.tagName </span><span style="--0:#BF3441;--1:#F97583">===</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;code&quot;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">&amp;&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">isElement</span><span style="--0:#24292E;--1:#E1E4E8">(parent) </span><span style="--0:#BF3441;--1:#F97583">&amp;&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> parent.tagName </span><span style="--0:#BF3441;--1:#F97583">!==</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;pre&quot;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#BF3441;--1:#F97583">||</span><span style="--0:#24292E;--1:#E1E4E8"> element.tagName </span><span style="--0:#BF3441;--1:#F97583">===</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;inlineCode&quot;</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span style="--0:#BF3441;--1:#F97583">function</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#6F42C1;--1:#B392F0">isBlockCode</span><span style="--0:#24292E;--1:#E1E4E8">(</span><span style="--0:#AE4B07;--1:#FFAB70">element</span><span style="--0:#24292E;--1:#E1E4E8">) {</span></div></div><div class="ec-line highlight del" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">  </span><span style="--0:#952933;--1:#fa96a1">return</span><span style="--0:#24292E;--1:#E1E4E8"> element.tagName </span><span style="--0:#952933;--1:#fa96a1">===</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;pre&quot;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#952933;--1:#fa96a1">&amp;&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> Array.</span><span style="--0:#613aa9;--1:#c0a5f3">isArray</span><span style="--0:#24292E;--1:#E1E4E8">(element.children) </span><span style="--0:#952933;--1:#fa96a1">&amp;&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> element.children.</span><span style="--0:#004fa9;--1:#79B8FF">length</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#952933;--1:#fa96a1">===</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#004fa9;--1:#79B8FF">1</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#952933;--1:#fa96a1">&amp;&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#613aa9;--1:#c0a5f3">isElement</span><span style="--0:#24292E;--1:#E1E4E8">(element.children[</span><span style="--0:#004fa9;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">]) </span><span style="--0:#952933;--1:#fa96a1">&amp;&amp;</span><span style="--0:#24292E;--1:#E1E4E8"> element.children[</span><span style="--0:#004fa9;--1:#79B8FF">0</span><span style="--0:#24292E;--1:#E1E4E8">].tagName </span><span style="--0:#952933;--1:#fa96a1">===</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#032F62;--1:#9ECBFF">&quot;code&quot;</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line highlight ins" style="--ecIndent:2ch"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">  </span><span style="--0:#982934;--1:#fb99a3">return</span><span style="--0:#24292E;--1:#E1E4E8"> </span><span style="--0:#004fa9;--1:#79B8FF">false</span><span style="--0:#24292E;--1:#E1E4E8">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="function isInlineCode(element, parent, bypass = false) {  if (bypass) {    return false;  }  return element.tagName === &#34;code&#34; &#38;&#38; isElement(parent) &#38;&#38; parent.tagName !== &#34;pre&#34; || element.tagName === &#34;inlineCode&#34;;}function isBlockCode(element) {  return element.tagName === &#34;pre&#34; &#38;&#38; Array.isArray(element.children) &#38;&#38; element.children.length === 1 &#38;&#38; isElement(element.children[0]) &#38;&#38; element.children[0].tagName === &#34;code&#34;;  return false;}"><div></div></button></div></figure></div>
<p>From here, I ran <code>npx patch-package rehype-pretty-code</code>, which created a <code>patches/rehype-pretty-code+0.14.1.patch</code> file with the changes I made:</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">patches/rehype-pretty-code+0.14.1.patch</span></figcaption><pre data-language="diff" class="wrap" style="--ecMaxLine:180ch"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#B31D28;--1:#FDAEB7">--- a/node_modules/rehype-pretty-code/dist/index.js</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#1E7734;--1:#85E89D">+++ b/node_modules/rehype-pretty-code/dist/index.js</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#6F42C1;--0fw:bold;--1:#B392F0;--1fw:bold">@@ -22,7 +22,7 @@</span><span style="--0:#24292E;--1:#E1E4E8"> function isInlineCode(element, parent, bypass = false) {</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">   </span></span><span style="--0:#24292E;--1:#E1E4E8">return element.tagName === &quot;code&quot; &amp;&amp; isElement(parent) &amp;&amp; parent.tagName !== &quot;pre&quot; || element.tagName === &quot;inlineCode&quot;;</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8"> </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8"> </span></span><span style="--0:#24292E;--1:#E1E4E8">function isBlockCode(element) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#B31D28;--1:#FDAEB7">-  return element.tagName === &quot;pre&quot; &amp;&amp; Array.isArray(element.children) &amp;&amp; element.children.length === 1 &amp;&amp; isElement(element.children[0]) &amp;&amp; element.children[0].tagName === &quot;code&quot;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#1E7734;--1:#85E89D">+  return false;</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8"> </span></span><span style="--0:#24292E;--1:#E1E4E8">}</span></div></div><div class="ec-line" style="--ecIndent:1ch"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8"> </span></span><span style="--0:#24292E;--1:#E1E4E8">function getInlineCodeLang(meta, defaultFallbackLang) {</span></div></div><div class="ec-line" style="--ecIndent:3ch"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent"><span style="--0:#24292E;--1:#E1E4E8">   </span></span><span style="--0:#24292E;--1:#E1E4E8">const placeholder = &quot;\0&quot;;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="--- a/node_modules/rehype-pretty-code/dist/index.js+++ b/node_modules/rehype-pretty-code/dist/index.js@@ -22,7 +22,7 @@ function isInlineCode(element, parent, bypass = false) {   return element.tagName === &#34;code&#34; &#38;&#38; isElement(parent) &#38;&#38; parent.tagName !== &#34;pre&#34; || element.tagName === &#34;inlineCode&#34;; } function isBlockCode(element) {-  return element.tagName === &#34;pre&#34; &#38;&#38; Array.isArray(element.children) &#38;&#38; element.children.length === 1 &#38;&#38; isElement(element.children[0]) &#38;&#38; element.children[0].tagName === &#34;code&#34;;+  return false; } function getInlineCodeLang(meta, defaultFallbackLang) {   const placeholder = &#34;\0&#34;;"><div></div></button></div></figure></div>
<p>This simple modification forces rehype-pretty-code to completely ignore block code elements by always returning <code>false{:js}</code> from the <code>isBlockCode{:js}</code> function. Now Expressive Code handles all block code formatting, while rehype-pretty-code still beautifully handles my inline code. And just like that, they‚Äôre working in perfect harmony!</p>
<h2 id="please-dont-perform-surgery-on-your-node_modules">Please don‚Äôt perform surgery on your node_modules</h2>
<p>Absolutely do not do this for production sites (your personal blog does not count =Ôø£œâÔø£=). Directly patching node modules is generally discouraged because patches can break with updates and create maintenance headaches down the road.</p>
<p>But sometimes, when you‚Äôre working at the bleeding edge of web development, temporary solutions like this become necessary. The better approach would be to just wait for Expressive Code to implement inline syntax highlighting. But, since it‚Äôll take a while for reasons aforementioned, I‚Äôll stick with my janky solution. This patch buys me time until either rehype-pretty-code gets maintained again and implements the feature properly, or Expressive Code adds inline code support.</p>
<p>In the meantime, astro-erudite now has both beautiful code blocks and inline syntax highlighting. And now it‚Äôs available for all of you to use!</p> </article>    <div class="col-start-2 pb-12"> <div class="mt-8 flex flex-col gap-4 border-t border-zinc-800 pt-8 sm:flex-row sm:justify-between"> <a href="/writing/the-state-of-static-blogs" class="group flex flex-col gap-1 text-left sm:max-w-[45%]"> <span class="flex items-center gap-1 font-mono text-xs text-zinc-500 transition-colors group-hover:text-yellow-500"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="size-3" data-icon="lucide:arrow-left">   <use href="#ai:lucide:arrow-left"></use>  </svg>
PREVIOUS_LOG
</span> <span class="group-hover:text-foreground line-clamp-2 text-sm font-bold text-zinc-300 transition-colors"> The State of Static Blogs in 2024 </span> </a> <a href="/writing/mobile-nav-and-subposts" class="group flex flex-col gap-1 text-right sm:max-w-[45%]"> <span class="flex items-center justify-end gap-1 font-mono text-xs text-zinc-500 transition-colors group-hover:text-yellow-500">
NEXT_LOG
<svg width="1em" height="1em" viewBox="0 0 24 24" class="size-3" data-icon="lucide:arrow-right">   <use href="#ai:lucide:arrow-right"></use>  </svg> </span> <span class="group-hover:text-foreground line-clamp-2 text-sm font-bold text-zinc-300 transition-colors"> v1.6.0: &quot;Mobile Navigation &amp; Subposts&quot; </span> </a> </div> </div> </section> <button data-slot="button" class="items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 size-9 group fixed right-8 bottom-8 z-50 hidden bg-background border-border hover:border-yellow-500" id="scroll-to-top" title="Scroll to top" aria-label="Scroll to top"> <svg width="1em" height="1em" class="mx-auto size-4 transition-all group-hover:-translate-y-0.5 text-muted-foreground group-hover:text-yellow-500" data-icon="lucide:arrow-up">   <symbol id="ai:lucide:arrow-up" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 12l7-7l7 7m-7 7V5"/></symbol><use href="#ai:lucide:arrow-up"></use>  </svg> </button> <script type="module">if(document.querySelector(".katex")&&!document.querySelector('link[href*="katex.min.css"]')){const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css",document.head.appendChild(e)}</script>  </main> <footer class="border-t border-zinc-800 bg-zinc-950 py-8 mt-12 text-center md:text-left"> <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4 text-xs font-mono text-zinc-600"> <div class="flex flex-col gap-1"> <span>&copy; 2026 ALVITO.DEV. ALL SYSTEMS NOMINAL.</span> <span>BUILT WITH ASTRO // DEPLOYED VIA GITHUB ACTIONS</span> </div> <div class="flex items-center gap-6"> <a href="https://github.com/alvitodev" target="_blank" class="hover:text-yellow-500 transition-colors">[GITHUB]</a> <a href="https://linkedin.com/in/alvito" target="_blank" class="hover:text-yellow-500 transition-colors">[LINKEDIN]</a> <a href="/rss.xml" class="hover:text-yellow-500 transition-colors">[RSS_FEED]</a> </div> <div class="text-right"> <p>SITE_REVISION: <span class="text-yellow-500">7bd091b</span></p> <p>LATENCY: <span class="text-green-500">LOW</span></p> </div> </div> </footer> </body></html> <script type="module">document.addEventListener("astro:page-load",()=>{const o=document.getElementById("scroll-to-top"),t=document.querySelector("footer");o&&t&&(o.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),window.addEventListener("scroll",()=>{const e=t.getBoundingClientRect().top<=window.innerHeight;o.classList.toggle("hidden",window.scrollY<=300||e)}))});</script>